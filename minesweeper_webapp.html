<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Minesweeper</title>
    <style>
        /* CSS section */
        body {
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
        }
        h1 { margin-bottom: 10px; }
        button {
            margin-bottom: 10px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
        }
        #grid {
            display: grid;
            grid-template-columns: repeat(6, 40px);
            gap: 2px;
        }
        .cell {
            width: 40px;
            height: 40px;
            background: grey;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
        }
        .revealed {
            background: grey;
            cursor: default;
        }
        .mine {
            background: red;
            font-size: 12px
        }
    </style>
</head>
<body>
    <h1>Minesweeper</h1>
    <p>Left click to reveal a cell, Right click to flag</p>
    <div id="grid"></div>
    <p id="status"></p>
    <button onclick="initialise()">Restart Game</button>
    <p>by Tom O'Grady</p>
    <script>
        /* JS section */

        const gridSize = 6;
        const mineCount = 8;
        const grid = document.getElementById("grid");
        const status = document.getElementById("status");
        let cells = [];
        let gameOver = false;

        function initialise() {
            grid.innerHTML = "";
            cells = [];
            gameOver = false;
            status.textContent = "";
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement("div");
                cell.className = "cell";
                cell.dataset.index = i;
                cell.addEventListener("click", () => revealCell(i));
                cell.addEventListener("contextmenu", (e) => {
                    e.preventDefault();
                    toggleFlag(i);
                });
                grid.appendChild(cell);
                cells.push({ element: cell, mine: false, revealed: false, flagged: false, adjacent: 0});
            }
            placeMines();
            calculateAdjacents();
        }

        function placeMines() {
            let placed = 0;
            while (placed < mineCount) {
                const i = Math.floor(Math.random() * cells.length);
                if (!cells[i].mine) {
                    cells[i].mine = true;
                    placed++;
                }
            }
        }

        function calculateAdjacents() {
            for (let i = 0; i < cells.length; i++) {
                const neighbors = getNeighbors(i);
                cells[i].adjacent = neighbors.filter(n => cells[n].mine).length;
            }
        }

        function getNeighbors(i) {
            const x = i % gridSize;
            const y = Math.floor(i / gridSize);
            const neighbors = [];
            for (let dy = -1; dy <= 1; dy++) {
                for (let dx = -1; dx <= 1; dx++) {
                    if (dx === 0 && dy === 0) continue;
                    const nx = x + dx;
                    const ny = y + dy;
                    if (nx >= 0 && nx < gridSize && ny >= 0 && ny < gridSize) {
                        neighbors.push(ny * gridSize + nx);
                    }
                }
            }
            return neighbors;
        }

        function revealCell(i) {
            const cell = cells[i];
            if (cell.revealed || cell.flagged || gameOver) return;
            cell.revealed = true;
            cell.element.classList.add("revealed");
            if (cell.mine) {
                endGame(false);
                return;
            }

            if (cell.adjacent > 0) {
                cell.element.textContent = cell.adjacent;
            } else {
                getNeighbors(i).forEach(revealCell);
            }
            checkWin();
        }

        function toggleFlag(i) {
            const cell = cells[i];
            if (cell.revealed || gameOver) return;
            cell.flagged = !cell.flagged;
            cell.element.textContent = cell.flagged ? "?" : "";
        }

        function checkWin() {
            if (cells.filter(c => !c.revealed && !c.mine).length === 0) {
                endGame(true);
            }
        }

        function endGame(won) {
            gameOver = true;
            status.textContent = won ? "You win!" : "Game Over!";
            if (!won) {
                cells.forEach(c => {
                    if (c.mine) {
                        c.element.textContent = "BOOM";
                        c.element.classList.add("mine");
                    }
                });
            }
        }

        initialise();
    </script>
</body>
</html>
